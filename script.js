// Multi-language translations
const translations = {
    en: {
        'app-name': 'VoiceLink',
        'privacy-policy-title': 'Privacy Policy',
        'last-updated': 'Last updated: January 12, 2026',
        'intro-text': 'This Privacy Policy describes how VoiceLink ("we", "our", or "us") collects, uses, and protects your information when you use our mobile application.',
        
        'information-collection-title': 'Information We Collect',
        'personal-info-title': 'Personal Information',
        'personal-info-1': 'Device identifiers for connection purposes',
        'personal-info-2': 'Network information for device discovery',
        'personal-info-3': 'Audio recordings (stored locally only)',
        'personal-info-4': 'Text messages (stored locally only)',
        'technical-info-title': 'Technical Information',
        'technical-info-1': 'Device model and operating system version',
        'technical-info-2': 'App version and usage statistics',
        'technical-info-3': 'Network connectivity status',
        
        'data-usage-title': 'How We Use Your Information',
        'data-usage-1': 'Enable voice and text communication between devices',
        'data-usage-2': 'Maintain connection stability and quality',
        'data-usage-3': 'Provide technical support and troubleshooting',
        'data-usage-4': 'Improve app performance and user experience',
        
        'data-storage-title': 'Data Storage and Security',
        'local-storage-title': 'Local Storage Only',
        'local-storage-desc': 'All your messages, voice recordings, and personal data are stored locally on your device. We do not upload, store, or access your personal communications on external servers.',
        'security-1': 'End-to-end encryption for all communications',
        'security-2': 'No cloud storage of personal data',
        'security-3': 'Secure local database with encryption',
        'security-4': 'Regular security updates and patches',
        
        'data-sharing-title': 'Data Sharing',
        'no-sharing-title': 'We Do Not Share Your Data',
        'no-sharing-desc': 'VoiceLink does not sell, trade, or share your personal information with third parties. Your communications remain private between connected devices.',
        
        'permissions-title': 'App Permissions',
        'microphone-title': 'Microphone',
        'microphone-desc': 'Required for voice recording and communication',
        'network-title': 'Network Access',
        'network-desc': 'Enables device discovery and communication',
        'storage-title': 'Storage',
        'storage-desc': 'Stores messages and settings locally',
        'notifications-title': 'Notifications',
        'notifications-desc': 'Alerts for incoming messages and calls',
        
        'user-rights-title': 'Your Rights',
        'user-rights-1': 'Delete all local data by uninstalling the app',
        'user-rights-2': 'Control which permissions to grant',
        'user-rights-3': 'Disable specific features at any time',
        'user-rights-4': 'Export or backup your data locally',
        
        'children-privacy-title': "Children's Privacy",
        'children-privacy-desc': 'VoiceLink is designed for general audiences. We do not knowingly collect personal information from children under 13. If you believe a child has provided personal information, please contact us to remove it.',
        
        'policy-changes-title': 'Changes to This Policy',
        'policy-changes-desc': 'We may update this Privacy Policy periodically. Changes will be posted in the app and on this page. Continued use of the app after changes constitutes acceptance of the updated policy.',
        
        'contact-title': 'Contact Us',
        'contact-desc': 'If you have questions about this Privacy Policy or our data practices, please contact us:',
        'email-label': 'Email:',
        'app-label': 'App:',
        
        'footer-rights': 'All rights reserved.',
        'footer-desc': 'Secure voice communication for everyone.'
    },
    
    ar: {
        'app-name': 'VoiceLink',
        'privacy-policy-title': 'سياسة الخصوصية',
        'last-updated': 'آخر تحديث: 12 يناير 2026',
        'intro-text': 'تصف سياسة الخصوصية هذه كيفية قيام VoiceLink ("نحن" أو "خاصتنا" أو "لنا") بجمع واستخدام وحماية معلوماتك عند استخدام تطبيق الهاتف المحمول الخاص بنا.',
        
        'information-collection-title': 'المعلومات التي نجمعها',
        'personal-info-title': 'المعلومات الشخصية',
        'personal-info-1': 'معرفات الجهاز لأغراض الاتصال',
        'personal-info-2': 'معلومات الشبكة لاكتشاف الأجهزة',
        'personal-info-3': 'التسجيلات الصوتية (مخزنة محلياً فقط)',
        'personal-info-4': 'الرسائل النصية (مخزنة محلياً فقط)',
        'technical-info-title': 'المعلومات التقنية',
        'technical-info-1': 'طراز الجهاز وإصدار نظام التشغيل',
        'technical-info-2': 'إصدار التطبيق وإحصائيات الاستخدام',
        'technical-info-3': 'حالة اتصال الشبكة',
        
        'data-usage-title': 'كيف نستخدم معلوماتك',
        'data-usage-1': 'تمكين التواصل الصوتي والنصي بين الأجهزة',
        'data-usage-2': 'الحفاظ على استقرار الاتصال وجودته',
        'data-usage-3': 'تقديم الدعم التقني واستكشاف الأخطاء وإصلاحها',
        'data-usage-4': 'تحسين أداء التطبيق وتجربة المستخدم',
        
        'data-storage-title': 'تخزين البيانات والأمان',
        'local-storage-title': 'التخزين المحلي فقط',
        'local-storage-desc': 'جميع رسائلك والتسجيلات الصوتية والبيانات الشخصية مخزنة محلياً على جهازك. نحن لا نرفع أو نخزن أو نصل إلى اتصالاتك الشخصية على خوادم خارجية.',
        'security-1': 'تشفير من طرف إلى طرف لجميع الاتصالات',
        'security-2': 'لا يوجد تخزين سحابي للبيانات الشخصية',
        'security-3': 'قاعدة بيانات محلية آمنة مع التشفير',
        'security-4': 'تحديثات أمنية منتظمة وإصلاحات',
        
        'data-sharing-title': 'مشاركة البيانات',
        'no-sharing-title': 'نحن لا نشارك بياناتك',
        'no-sharing-desc': 'VoiceLink لا يبيع أو يتاجر أو يشارك معلوماتك الشخصية مع أطراف ثالثة. تبقى اتصالاتك خاصة بين الأجهزة المتصلة.',
        
        'permissions-title': 'أذونات التطبيق',
        'microphone-title': 'الميكروفون',
        'microphone-desc': 'مطلوب للتسجيل الصوتي والتواصل',
        'network-title': 'الوصول للشبكة',
        'network-desc': 'يمكن اكتشاف الأجهزة والتواصل',
        'storage-title': 'التخزين',
        'storage-desc': 'يخزن الرسائل والإعدادات محلياً',
        'notifications-title': 'الإشعارات',
        'notifications-desc': 'تنبيهات للرسائل والمكالمات الواردة',
        
        'user-rights-title': 'حقوقك',
        'user-rights-1': 'حذف جميع البيانات المحلية بإلغاء تثبيت التطبيق',
        'user-rights-2': 'التحكم في الأذونات الممنوحة',
        'user-rights-3': 'تعطيل ميزات محددة في أي وقت',
        'user-rights-4': 'تصدير أو نسخ احتياطي لبياناتك محلياً',
        
        'children-privacy-title': 'خصوصية الأطفال',
        'children-privacy-desc': 'VoiceLink مصمم للجمهور العام. نحن لا نجمع عن قصد معلومات شخصية من الأطفال دون سن 13. إذا كنت تعتقد أن طفلاً قدم معلومات شخصية، يرجى الاتصال بنا لإزالتها.',
        
        'policy-changes-title': 'التغييرات على هذه السياسة',
        'policy-changes-desc': 'قد نحدث سياسة الخصوصية هذه بشكل دوري. ستُنشر التغييرات في التطبيق وعلى هذه الصفحة. الاستمرار في استخدام التطبيق بعد التغييرات يشكل قبولاً للسياسة المحدثة.',
        
        'contact-title': 'اتصل بنا',
        'contact-desc': 'إذا كان لديك أسئلة حول سياسة الخصوصية هذه أو ممارسات البيانات الخاصة بنا، يرجى الاتصال بنا:',
        'email-label': 'البريد الإلكتروني:',
        'app-label': 'التطبيق:',
        
        'footer-rights': 'جميع الحقوق محفوظة.',
        'footer-desc': 'تواصل صوتي آمن للجميع.'
    },
    
    tr: {
        'app-name': 'VoiceLink',
        'privacy-policy-title': 'Gizlilik Politikası',
        'last-updated': 'Son güncelleme: 12 Ocak 2026',
        'intro-text': 'Bu Gizlilik Politikası, VoiceLink ("biz", "bizim" veya "bize") mobil uygulamamızı kullandığınızda bilgilerinizi nasıl topladığımızı, kullandığımızı ve koruduğumuzu açıklar.',
        
        'information-collection-title': 'Topladığımız Bilgiler',
        'personal-info-title': 'Kişisel Bilgiler',
        'personal-info-1': 'Bağlantı amaçları için cihaz tanımlayıcıları',
        'personal-info-2': 'Cihaz keşfi için ağ bilgileri',
        'personal-info-3': 'Ses kayıtları (yalnızca yerel olarak saklanır)',
        'personal-info-4': 'Metin mesajları (yalnızca yerel olarak saklanır)',
        'technical-info-title': 'Teknik Bilgiler',
        'technical-info-1': 'Cihaz modeli ve işletim sistemi sürümü',
        'technical-info-2': 'Uygulama sürümü ve kullanım istatistikleri',
        'technical-info-3': 'Ağ bağlantı durumu',
        
        'data-usage-title': 'Bilgilerinizi Nasıl Kullanırız',
        'data-usage-1': 'Cihazlar arasında ses ve metin iletişimini etkinleştir',
        'data-usage-2': 'Bağlantı kararlılığını ve kalitesini korur',
        'data-usage-3': 'Teknik destek ve sorun giderme sağlar',
        'data-usage-4': 'Uygulama performansını ve kullanıcı deneyimini iyileştirir',
        
        'data-storage-title': 'Veri Depolama ve Güvenlik',
        'local-storage-title': 'Yalnızca Yerel Depolama',
        'local-storage-desc': 'Tüm mesajlarınız, ses kayıtlarınız ve kişisel verileriniz cihazınızda yerel olarak saklanır. Kişisel iletişimlerinizi harici sunucularda yüklemez, saklamaz veya erişmeyiz.',
        'security-1': 'Tüm iletişimler için uçtan uca şifreleme',
        'security-2': 'Kişisel verilerin bulut depolaması yok',
        'security-3': 'Şifrelemeli güvenli yerel veritabanı',
        'security-4': 'Düzenli güvenlik güncellemeleri ve yamalar',
        
        'data-sharing-title': 'Veri Paylaşımı',
        'no-sharing-title': 'Verilerinizi Paylaşmıyoruz',
        'no-sharing-desc': 'VoiceLink kişisel bilgilerinizi üçüncü taraflarla satmaz, takas etmez veya paylaşmaz. İletişimleriniz bağlı cihazlar arasında gizli kalır.',
        
        'permissions-title': 'Uygulama İzinleri',
        'microphone-title': 'Mikrofon',
        'microphone-desc': 'Ses kaydı ve iletişim için gerekli',
        'network-title': 'Ağ Erişimi',
        'network-desc': 'Cihaz keşfi ve iletişimi sağlar',
        'storage-title': 'Depolama',
        'storage-desc': 'Mesajları ve ayarları yerel olarak saklar',
        'notifications-title': 'Bildirimler',
        'notifications-desc': 'Gelen mesajlar ve aramalar için uyarılar',
        
        'user-rights-title': 'Haklarınız',
        'user-rights-1': 'Uygulamayı kaldırarak tüm yerel verileri silin',
        'user-rights-2': 'Hangi izinlerin verileceğini kontrol edin',
        'user-rights-3': 'Belirli özellikleri istediğiniz zaman devre dışı bırakın',
        'user-rights-4': 'Verilerinizi yerel olarak dışa aktarın veya yedekleyin',
        
        'children-privacy-title': 'Çocukların Gizliliği',
        'children-privacy-desc': 'VoiceLink genel kitle için tasarlanmıştır. 13 yaşın altındaki çocuklardan bilerek kişisel bilgi toplamayız. Bir çocuğun kişisel bilgi verdiğine inanıyorsanız, kaldırmak için bizimle iletişime geçin.',
        
        'policy-changes-title': 'Bu Politikadaki Değişiklikler',
        'policy-changes-desc': 'Bu Gizlilik Politikasını periyodik olarak güncelleyebiliriz. Değişiklikler uygulamada ve bu sayfada yayınlanacaktır. Değişikliklerden sonra uygulamayı kullanmaya devam etmek, güncellenen politikanın kabulü anlamına gelir.',
        
        'contact-title': 'Bize Ulaşın',
        'contact-desc': 'Bu Gizlilik Politikası veya veri uygulamalarımız hakkında sorularınız varsa, lütfen bizimle iletişime geçin:',
        'email-label': 'E-posta:',
        'app-label': 'Uygulama:',
        
        'footer-rights': 'Tüm hakları saklıdır.',
        'footer-desc': 'Herkes için güvenli ses iletişimi.'
    }
};

// Theme management
class ThemeManager {
    constructor() {
        this.init();
    }
    
    init() {
        // Detect system theme preference
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const savedTheme = localStorage.getItem('theme');
        
        // Set initial theme
        const theme = savedTheme || (prefersDark ? 'dark' : 'light');
        this.setTheme(theme);
        
        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) {
                this.setTheme(e.matches ? 'dark' : 'light');
            }
        });
        
        // Theme toggle button
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', () => this.toggleTheme());
        }
    }
    
    setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
    }
    
    toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        this.setTheme(newTheme);
    }
}

// Language management
class LanguageManager {
    constructor() {
        this.currentLanguage = 'en';
        this.init();
    }
    
    init() {
        // Detect browser language
        const browserLang = navigator.language.split('-')[0];
        const supportedLangs = ['en', 'ar', 'tr'];
        const savedLang = localStorage.getItem('language');
        
        // Set initial language
        const lang = savedLang || (supportedLangs.includes(browserLang) ? browserLang : 'en');
        this.setLanguage(lang);
        
        // Language selector
        const languageSelector = document.getElementById('language-selector');
        if (languageSelector) {
            languageSelector.value = lang;
            languageSelector.addEventListener('change', (e) => {
                this.setLanguage(e.target.value);
            });
        }
    }
    
    setLanguage(lang) {
        this.currentLanguage = lang;
        
        // Update HTML attributes
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        
        // Update all translatable elements
        this.updateTranslations();
        
        // Save preference
        localStorage.setItem('language', lang);
        
        // Update language selector
        const languageSelector = document.getElementById('language-selector');
        if (languageSelector) {
            languageSelector.value = lang;
        }
    }
    
    updateTranslations() {
        const elements = document.querySelectorAll('[data-key]');
        elements.forEach(element => {
            const key = element.getAttribute('data-key');
            const translation = translations[this.currentLanguage][key];
            if (translation) {
                element.textContent = translation;
            }
        });
    }
}

// Smooth scrolling for anchor links
class SmoothScroll {
    constructor() {
        this.init();
    }
    
    init() {
        // Add smooth scrolling to all anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', (e) => {
                e.preventDefault();
                const target = document.querySelector(anchor.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    }
}

// Animation on scroll
class ScrollAnimations {
    constructor() {
        this.init();
    }
    
    init() {
        // Create intersection observer for fade-in animations
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        });
        
        // Observe all sections
        document.querySelectorAll('.section').forEach(section => {
            observer.observe(section);
        });
    }
}

// Accessibility enhancements
class AccessibilityManager {
    constructor() {
        this.init();
    }
    
    init() {
        // Skip to main content link
        this.addSkipLink();
        
        // Keyboard navigation for custom elements
        this.enhanceKeyboardNavigation();
        
        // Focus management
        this.manageFocus();
    }
    
    addSkipLink() {
        const skipLink = document.createElement('a');
        skipLink.href = '#main-content';
        skipLink.textContent = 'Skip to main content';
        skipLink.className = 'skip-link';
        skipLink.style.cssText = `
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-color);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
            transition: top 0.3s;
        `;
        
        skipLink.addEventListener('focus', () => {
            skipLink.style.top = '6px';
        });
        
        skipLink.addEventListener('blur', () => {
            skipLink.style.top = '-40px';
        });
        
        document.body.insertBefore(skipLink, document.body.firstChild);
        
        // Add id to main content
        const mainContent = document.querySelector('.content');
        if (mainContent) {
            mainContent.id = 'main-content';
            mainContent.setAttribute('tabindex', '-1');
        }
    }
    
    enhanceKeyboardNavigation() {
        // Add keyboard support for theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    themeToggle.click();
                }
            });
        }
    }
    
    manageFocus() {
        // Ensure focus is visible
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                document.body.classList.add('keyboard-navigation');
            }
        });
        
        document.addEventListener('mousedown', () => {
            document.body.classList.remove('keyboard-navigation');
        });
    }
}

// Performance monitoring
class PerformanceMonitor {
    constructor() {
        this.init();
    }
    
    init() {
        // Monitor page load performance
        window.addEventListener('load', () => {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart, 'ms');
            }
        });
        
        // Monitor memory usage (if available)
        if ('memory' in performance) {
            setInterval(() => {
                const memory = performance.memory;
                if (memory.usedJSHeapSize > memory.jsHeapSizeLimit * 0.9) {
                    console.warn('High memory usage detected');
                }
            }, 30000);
        }
    }
}

// Error handling
class ErrorHandler {
    constructor() {
        this.init();
    }
    
    init() {
        // Global error handler
        window.addEventListener('error', (e) => {
            console.error('Global error:', e.error);
            this.showErrorMessage('An unexpected error occurred. Please refresh the page.');
        });
        
        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e.reason);
            this.showErrorMessage('A network error occurred. Please check your connection.');
        });
    }
    
    showErrorMessage(message) {
        // Create error notification
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-notification';
        errorDiv.textContent = message;
        errorDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f44336;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        
        document.body.appendChild(errorDiv);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            if (errorDiv.parentNode) {
                errorDiv.parentNode.removeChild(errorDiv);
            }
        }, 5000);
    }
}

// Initialize all managers when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    // Initialize all components
    new ThemeManager();
    new LanguageManager();
    new SmoothScroll();
    new ScrollAnimations();
    new AccessibilityManager();
    new PerformanceMonitor();
    new ErrorHandler();
    
    // Add loading complete class
    document.body.classList.add('loaded');
    
    console.log('VoiceLink Privacy Policy loaded successfully');
});

// Service Worker registration (for offline support)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then(registration => {
                console.log('SW registered: ', registration);
            })
            .catch(registrationError => {
                console.log('SW registration failed: ', registrationError);
            });
    });
}